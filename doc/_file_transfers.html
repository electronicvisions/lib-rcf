
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>Remote Call Framework (RCF) - Delta V Software</title>
    <!-- Bootstrap core CSS -->
    <link href="../vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom styles for this template -->
    <!-- JL: Using timestamp here to prevent css file from being cached -->
    <link href="../css/website.css?<?php echo time(); ?>" rel="stylesheet" />
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="dynsections.js"></script>
    <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
    <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
    <link href="doxygenBase.css" rel="stylesheet" type="text/css" />
    <link href="doxyStylesheet.css" rel="stylesheet" type="text/css"/>
<link href="doxySidebarFixes.css" rel="stylesheet" type="text/css"/>
    <link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet" />
    <script type="text/javascript" src="doxy-boot.js"></script>
</head>
<body style="padding-top: 0px">
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light navbar-fixed-top" style="top: 20px;">
        <!-- <nav class="navbar navbar-expand-lg fixed-top"> -->
        <div class="container">
            <a class="navbar-brand" href="index.html"><img src="RCF_Logo_70px.png" height="70" /> </img></a>
            <!--
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item" style="padding-top: 0px;">
                        <a class="nav-link" href="../index.html"><i class="fa fa-home"></i></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">Documentation</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../download.html">Download</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../licensing.html">Licensing</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../about.html">About</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../contact.html">Contact</a>
                    </li>
                </ul>
            </div>
                -->
        </div>
    </nav>
        <div class="container">
        <div class="row">
            <div class="col-lg-12">
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Remote Call Framework 3.1
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_file_transfers.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">File Transfers </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#FileDownloads">File Downloads</a></li>
<li class="level1"><a href="#FileUploads">File Uploads</a></li>
<li class="level1"><a href="#ResumingFileTransfers">Resuming File Transfers</a></li>
<li class="level1"><a href="#MonitoringFileTransfers">Monitoring File Transfers</a></li>
<li class="level1"><a href="#BandwidthLimits">Bandwidth Limits</a><ul><li class="level2"><a href="#RcfServerBandwidthLimit">Server-Side Bandwidth Limits</a></li>
<li class="level2"><a href="#CustomBandwidthLimit">Custom Server-Side Bandwidth Limits</a></li>
<li class="level2"><a href="#ClientBandwidthLimit">Client-Side Bandwidth Limits</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p>RCF has built-in support for transferring files. While smaller files can be transferred easily in a single remote call, for example by using a <code><a class="el" href="class_r_c_f_1_1_byte_buffer.html">RCF::ByteBuffer</a></code> parameter, this technique fails once the size of the file exceeds the maximum message size of the connection.</p>
<p>To reliably transfer a file of arbitrary size, the file needs to be split into chunks and transmitted in separate calls, with the recipient reassembling the chunks to form the destination file. Furthermore, to attain maximum throughput speeds for large transfers, it is also necessary to run network I/O and disk I/O concurrently.</p>
<p>When you use RCF's built in file transfer functionality, these details are taken care of automatically.</p>
<p>File transfers take place on the same connection as any remote calls you make. So if you enable encryption or compression for a RCF client (see <a class="el" href="_transport_protocols.html">Transport Protocols</a>), the settings will apply to any file transfers performed by that RCF client as well.</p>
<p>To use file transfer functionality, you must define <code>RCF_FEATURE_FILETRANSFER=1</code> in your build (see <a class="el" href="_building_r_c_f.html">Building RCF</a>).</p>
<h1><a class="anchor" id="FileDownloads"></a>
File Downloads</h1>
<p>To download a file from a <code>RcfServer</code>, use <code><a class="el" href="class_r_c_f_1_1_client_stub.html#a651399c13f012a6c23c498ec17422930" title="Downloads a file from a RcfServer. The download must already have been configured by the server...">RCF::ClientStub::downloadFile()</a></code>.</p>
<p>The first argument to <code><a class="el" href="class_r_c_f_1_1_client_stub.html#a651399c13f012a6c23c498ec17422930" title="Downloads a file from a RcfServer. The download must already have been configured by the server...">RCF::ClientStub::downloadFile()</a></code> is a download ID, which must be allocated by the <code>RcfServer</code>. Typically the client will make a remote call to the server, and as part of the response to the remote call, a download ID is allocated by your server-side application code, by calling <code><a class="el" href="class_r_c_f_1_1_rcf_session.html#a924041739db1137b9b0395f573a2ae44" title="Configures a file download from the given download path. Returns a download ID, which should be passe...">RCF::RcfSession::configureDownload()</a></code>. The download ID is returned to the client.</p>
<p>The client then uses the download ID to actually download the file.</p>
<div class="fragment"><div class="line"></div><div class="line"><span class="comment">// Server-side code.</span></div><div class="line"></div><div class="line">RCF_BEGIN(I_PrintService, <span class="stringliteral">&quot;&quot;</span>)</div><div class="line">    RCF_METHOD_V1(<span class="keywordtype">void</span>, Print, const std::<span class="keywordtype">string</span>&amp;)</div><div class="line">    RCF_METHOD_R0(std::<span class="keywordtype">string</span>, GetDocument)</div><div class="line">RCF_END(I_PrintService)</div><div class="line"></div><div class="line">class PrintService</div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="keywordtype">void</span> Print(<span class="keyword">const</span> std::string&amp; msg)</div><div class="line">    {</div><div class="line">        std::cout &lt;&lt; msg;</div><div class="line">    }</div><div class="line"></div><div class="line">    std::string GetDocument()</div><div class="line">    {</div><div class="line">        <a class="code" href="_file_system_8hpp.html#acd9dc05ff33e8a344d94fe7fb9421092">RCF::Path</a> fileToDownload = <span class="stringliteral">&quot;C:\\Document1.pdf&quot;</span>;</div><div class="line">        std::string downloadId = <a class="code" href="_rcf_session_8hpp.html#a9d9e37f6e66bcbc3a1f6e5775d107cb2">RCF::getCurrentRcfSession</a>().<a class="code" href="class_r_c_f_1_1_rcf_session.html#a924041739db1137b9b0395f573a2ae44">configureDownload</a>(fileToDownload);</div><div class="line">        <span class="keywordflow">return</span> downloadId;</div><div class="line">    }</div><div class="line">};</div></div><!-- fragment --> <div class="fragment"><div class="line"></div><div class="line">    <span class="comment">// Server-side code.</span></div><div class="line"></div><div class="line">    <a class="code" href="class_r_c_f_1_1_rcf_server.html">RCF::RcfServer</a> server(<a class="code" href="class_r_c_f_1_1_tcp_endpoint.html">RCF::TcpEndpoint</a>(50001));</div><div class="line"></div><div class="line">    PrintService printService;</div><div class="line">    server.<a class="code" href="class_r_c_f_1_1_rcf_server.html#a3e8f6a060a87beb96b5690e9829c9c3f">bind</a>&lt;I_PrintService&gt;(printService);</div><div class="line"></div><div class="line">    server.<a class="code" href="class_r_c_f_1_1_rcf_server.html#a737d7cf9860b1d49209b2ebe891e4449">start</a>();</div></div><!-- fragment --> <div class="fragment"><div class="line"></div><div class="line">    <span class="comment">// Client-side code.</span></div><div class="line"></div><div class="line">    RcfClient&lt;I_PrintService&gt; client(<a class="code" href="class_r_c_f_1_1_tcp_endpoint.html">RCF::TcpEndpoint</a>(50001));</div><div class="line"></div><div class="line">    std::string downloadId = client.GetDocument();</div><div class="line"></div><div class="line">    <a class="code" href="_file_system_8hpp.html#acd9dc05ff33e8a344d94fe7fb9421092">RCF::Path</a> fileToDownloadTo = <span class="stringliteral">&quot;C:\\Document1.pdf&quot;</span>;</div><div class="line">    client.getClientStub().downloadFile(downloadId, fileToDownloadTo);</div></div><!-- fragment --><p> <code><a class="el" href="class_r_c_f_1_1_client_stub.html#a651399c13f012a6c23c498ec17422930" title="Downloads a file from a RcfServer. The download must already have been configured by the server...">RCF::ClientStub::downloadFile()</a></code> also takes a third, optional, argument, of type <code><a class="el" href="class_r_c_f_1_1_file_transfer_options.html" title="Client side options for downloading and uploading files. ">RCF::FileTransferOptions</a></code>. <code><a class="el" href="class_r_c_f_1_1_file_transfer_options.html" title="Client side options for downloading and uploading files. ">RCF::FileTransferOptions</a></code> contains further options for customizing the file transfer, including the ability to download fragments of a file, and assign bandwidth controls to the transfer.</p>
<div class="fragment"><div class="line">    <a class="code" href="class_r_c_f_1_1_file_transfer_options.html">RCF::FileTransferOptions</a> transferOptions;</div><div class="line">    transferOptions.<a class="code" href="class_r_c_f_1_1_file_transfer_options.html#ab065964692da6577dd82b01949e37e9d">mBandwidthLimitBps</a> = 1024 * 1024; <span class="comment">// 1 MB/sec</span></div><div class="line">    client.getClientStub().downloadFile(downloadId, fileToDownloadTo, &amp;transferOptions);</div></div><!-- fragment --> <h1><a class="anchor" id="FileUploads"></a>
File Uploads</h1>
<p>To upload a file to a <code>RcfServer</code>, use <code><a class="el" href="class_r_c_f_1_1_client_stub.html#a8d2a5dbe6eabef001155c37037ab6984" title="Uploads a file to a RcfServer. The RcfServer must previously have enabled uploads and configured an u...">RCF::ClientStub::uploadFile()</a></code>.</p>
<p>Uploading files is performed similarly to downloading. The first argument to <code><a class="el" href="class_r_c_f_1_1_client_stub.html#a8d2a5dbe6eabef001155c37037ab6984" title="Uploads a file to a RcfServer. The RcfServer must previously have enabled uploads and configured an u...">RCF::ClientStub::uploadFile()</a></code> is an upload ID that is assigned by the client, and is used in subsequent remote calls by the client to identify the upload.</p>
<p>Once <code><a class="el" href="class_r_c_f_1_1_client_stub.html#a8d2a5dbe6eabef001155c37037ab6984" title="Uploads a file to a RcfServer. The RcfServer must previously have enabled uploads and configured an u...">RCF::ClientStub::uploadFile()</a></code> returns, you can pass the upload ID as a parameter in remote calls, and your server-side application code can then retrieve the uploaded file using the upload ID.</p>
<div class="fragment"><div class="line"></div><div class="line"><span class="comment">// Server-side code.</span></div><div class="line"></div><div class="line">RCF_BEGIN(I_PrintService, <span class="stringliteral">&quot;&quot;</span>)</div><div class="line">    RCF_METHOD_V1(<span class="keywordtype">void</span>, Print, const std::<span class="keywordtype">string</span>&amp;)</div><div class="line">    RCF_METHOD_V1(<span class="keywordtype">void</span>, AddDocument, const std::<span class="keywordtype">string</span>&amp;)</div><div class="line">RCF_END(I_PrintService)</div><div class="line"></div><div class="line">class PrintService</div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="keywordtype">void</span> Print(<span class="keyword">const</span> std::string&amp; msg)</div><div class="line">    {</div><div class="line">        std::cout &lt;&lt; msg;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> AddDocument(<span class="keyword">const</span> std::string&amp; uploadId)</div><div class="line">    {</div><div class="line">        <a class="code" href="_file_system_8hpp.html#acd9dc05ff33e8a344d94fe7fb9421092">RCF::Path</a> pathToUpload = <a class="code" href="_rcf_session_8hpp.html#a9d9e37f6e66bcbc3a1f6e5775d107cb2">RCF::getCurrentRcfSession</a>().<a class="code" href="class_r_c_f_1_1_rcf_session.html#a00710bfd731ea2d674b1771f6b1e4618">getUploadPath</a>(uploadId);</div><div class="line"></div><div class="line">        <span class="comment">// Application-specific code to process the uploaded file.</span></div><div class="line">        <span class="comment">// ...</span></div><div class="line"></div><div class="line">        <span class="keyword">namespace </span>fs = std::experimental::filesystem;</div><div class="line">        fs::remove(pathToUpload);</div><div class="line">    }</div><div class="line">};</div><div class="line"></div></div><!-- fragment --> <div class="fragment"><div class="line"></div><div class="line">    <span class="comment">// Server-side code.</span></div><div class="line"></div><div class="line">    <a class="code" href="class_r_c_f_1_1_rcf_server.html">RCF::RcfServer</a> server(<a class="code" href="class_r_c_f_1_1_tcp_endpoint.html">RCF::TcpEndpoint</a>(50001));</div><div class="line"></div><div class="line">    PrintService printService;</div><div class="line">    server.<a class="code" href="class_r_c_f_1_1_rcf_server.html#a3e8f6a060a87beb96b5690e9829c9c3f">bind</a>&lt;I_PrintService&gt;(printService);</div><div class="line">    </div><div class="line">    server.<a class="code" href="class_r_c_f_1_1_rcf_server.html#a2a99bbc9b76aede330a85b5ff640db73">setUploadDirectory</a>(<span class="stringliteral">&quot;C:\\MyApp\\Uploads&quot;</span>);</div><div class="line">    </div><div class="line">    server.<a class="code" href="class_r_c_f_1_1_rcf_server.html#a737d7cf9860b1d49209b2ebe891e4449">start</a>();</div><div class="line"></div></div><!-- fragment --> <div class="fragment"><div class="line"></div><div class="line">    <span class="comment">// Client-side code.</span></div><div class="line"></div><div class="line">    RcfClient&lt;I_PrintService&gt; client(<a class="code" href="class_r_c_f_1_1_tcp_endpoint.html">RCF::TcpEndpoint</a>(50001));</div><div class="line"></div><div class="line">    std::string uploadId = RCF::generateUuid();</div><div class="line">    <a class="code" href="_file_system_8hpp.html#acd9dc05ff33e8a344d94fe7fb9421092">RCF::Path</a> fileToUpload = <span class="stringliteral">&quot;C:\\Document1.pdf&quot;</span>;</div><div class="line">    client.getClientStub().uploadFile(uploadId, fileToUpload);</div><div class="line"></div><div class="line">    client.AddDocument(uploadId);</div><div class="line"></div></div><!-- fragment --><p> Just as for downloads, <code><a class="el" href="class_r_c_f_1_1_client_stub.html#a8d2a5dbe6eabef001155c37037ab6984" title="Uploads a file to a RcfServer. The RcfServer must previously have enabled uploads and configured an u...">RCF::ClientStub::uploadFile()</a></code> takes a third, optional, argument of type <code><a class="el" href="class_r_c_f_1_1_file_transfer_options.html" title="Client side options for downloading and uploading files. ">RCF::FileTransferOptions</a></code>, with further options for customizing the upload.</p>
<div class="fragment"><div class="line">    <a class="code" href="class_r_c_f_1_1_file_transfer_options.html">RCF::FileTransferOptions</a> transferOptions;</div><div class="line">    transferOptions.<a class="code" href="class_r_c_f_1_1_file_transfer_options.html#ab065964692da6577dd82b01949e37e9d">mBandwidthLimitBps</a> = 1024 * 1024; <span class="comment">// 1 MB/sec</span></div><div class="line">    client.getClientStub().uploadFile(uploadId, fileToUpload, &amp;transferOptions);</div></div><!-- fragment --><p> Note that on the server-side, <code><a class="el" href="class_r_c_f_1_1_rcf_server.html#a2a99bbc9b76aede330a85b5ff640db73" title="Sets the path under which client uploads are saved. Must be set before any files can be uploaded...">RCF::RcfServer::setUploadDirectory()</a></code> must be called to specify a location for uploaded files. This property must be set before any uploads can take place.</p>
<p>Once a file has been uploaded to a server, it is the responsibility of your server-side application code to manage its lifetime.</p>
<h1><a class="anchor" id="ResumingFileTransfers"></a>
Resuming File Transfers</h1>
<h2>Resuming downloads</h2>
<p>If a network disconnection or other problem occurs during a download, <code><a class="el" href="class_r_c_f_1_1_client_stub.html#a651399c13f012a6c23c498ec17422930" title="Downloads a file from a RcfServer. The download must already have been configured by the server...">RCF::ClientStub::downloadFile()</a></code> will throw an exception. To resume the download, once the connection is re-established, you can call <code>downloadFile()</code> again, with the same parameters. RCF will resume the download at the point at which it was interrupted.</p>
<h2>Resuming uploads</h2>
<p>If a network disconnection or other problem occurs during an upload, <code><a class="el" href="class_r_c_f_1_1_client_stub.html#a8d2a5dbe6eabef001155c37037ab6984" title="Uploads a file to a RcfServer. The RcfServer must previously have enabled uploads and configured an u...">RCF::ClientStub::uploadFile()</a></code> will throw an exception. To resume the upload, once the connection is re-established, you can call <code>uploadFile()</code> again, with the same parameters. RCF will resume the upload at the point at which it was interrupted.</p>
<h1><a class="anchor" id="MonitoringFileTransfers"></a>
Monitoring File Transfers</h1>
<p>On the client-side, to monitor a file transfer, use the <code><a class="el" href="class_r_c_f_1_1_file_transfer_options.html" title="Client side options for downloading and uploading files. ">RCF::FileTransferOptions</a></code> parameter and set <code><a class="el" href="class_r_c_f_1_1_file_transfer_options.html#a6b7f8fd92eba852b76b192818425a92e" title="Progress callback. Called during the transfer to provide progress information. ">RCF::FileTransferOptions::mProgressCallback</a></code> to an application-defined callback function. The callback function will be called repeatedly until the file transfer completes.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> clientTransferProgress(<span class="keyword">const</span> <a class="code" href="class_r_c_f_1_1_file_transfer_progress.html">RCF::FileTransferProgress</a>&amp; progress, <a class="code" href="group___r_c_f.html#gacbd77f925dc515e537b44b3ec25d0cd7">RCF::RemoteCallAction</a>&amp; action)</div><div class="line">{</div><div class="line">    <span class="keywordtype">double</span> percentComplete = (double)progress.<a class="code" href="class_r_c_f_1_1_file_transfer_progress.html#a2e67cd68451c69525cd934b19a0d23fe">mBytesTransferredSoFar</a> / (<span class="keywordtype">double</span>)progress.<a class="code" href="class_r_c_f_1_1_file_transfer_progress.html#a7c06223dcb8a3f0ed67d1d9b53cc838a">mBytesTotalToTransfer</a>;</div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Download progress: &quot;</span> &lt;&lt; percentComplete &lt;&lt; <span class="stringliteral">&quot;%&quot;</span> &lt;&lt; std::endl;</div><div class="line">}</div></div><!-- fragment --><div class="fragment"><div class="line">    <a class="code" href="class_r_c_f_1_1_file_transfer_options.html">RCF::FileTransferOptions</a> transferOptions;</div><div class="line">    transferOptions.<a class="code" href="class_r_c_f_1_1_file_transfer_options.html#a6b7f8fd92eba852b76b192818425a92e">mProgressCallback</a> = &amp;clientTransferProgress;</div><div class="line">    client.getClientStub().downloadFile(downloadId, fileToDownloadTo);</div></div><!-- fragment --><p> On the server-side, you can use <code><a class="el" href="class_r_c_f_1_1_rcf_server.html#a560a85611e6eba9d21934a29dc802c12" title="Sets the download progress callback for this RcfServer. The callback is called for every chunk that i...">RCF::RcfServer::setDownloadProgressCallback()</a></code> and <code><a class="el" href="class_r_c_f_1_1_rcf_server.html#acbe5df6252176feec8e2666ef38bf1df" title="Sets the upload progress callback for this RcfServer. The callback is called for every chunk that is ...">RCF::RcfServer::setUploadProgressCallback()</a></code>, to register a callback which will be called every time a chunk is downloaded or uploaded, for any download or upload on that server.</p>
<p>From the callback you can inspect the associated <code><a class="el" href="class_r_c_f_1_1_rcf_session.html" title="Represents a server side session, associated with a client connection. ">RCF::RcfSession</a></code>, <code><a class="el" href="class_r_c_f_1_1_file_download_info.html" title="Server-side information about a file download taking place from a RcfServer. ">RCF::FileDownloadInfo</a></code> and <code><a class="el" href="class_r_c_f_1_1_file_upload_info.html" title="Server-side information about a file upload taking place to a RcfServer. ">RCF::FileUploadInfo</a></code> objects. To cancel a file transfer, throw an exception from the callback.</p>
<h1><a class="anchor" id="BandwidthLimits"></a>
Bandwidth Limits</h1>
<p>RCF file transfers will automatically consume as much bandwidth as the network allows. However, in some cases you may want to run file transfers with restricted bandwidth, in order to limit total network bandwidth usage.</p>
<h2><a class="anchor" id="RcfServerBandwidthLimit"></a>
Server-Side Bandwidth Limits</h2>
<p>You can use <code><a class="el" href="class_r_c_f_1_1_rcf_server.html#abd33667252be8b2d2d839ce4e0118928" title="Sets the total bandwidth limit for all uploads to this RcfServer. By default the bandwidth limit is z...">RCF::RcfServer::setUploadBandwidthLimit()</a></code> and <code><a class="el" href="class_r_c_f_1_1_rcf_server.html#adbd72dda3ffa83def219bb47dd3d3e50" title="Sets the total bandwidth limit for all downloads from this RcfServer. By default the bandwidth limit ...">RCF::RcfServer::setDownloadBandwidthLimit()</a></code>, to set a maximum total bandwidth to be consumed by all file transfers to and from a <code>RcfServer</code>.</p>
<p>Here is an example of setting a 1 Mbps upload limit and a 5 Mbps download limit:</p>
<div class="fragment"><div class="line">    <a class="code" href="class_r_c_f_1_1_rcf_server.html">RCF::RcfServer</a> server( <a class="code" href="class_r_c_f_1_1_tcp_endpoint.html">RCF::TcpEndpoint</a>(50001) );</div><div class="line"></div><div class="line">    <span class="comment">// 1 Mbps upload limit.</span></div><div class="line">    std::uint32_t serverUploadLimitMbps = 1;</div><div class="line"></div><div class="line">    <span class="comment">// Convert to bytes/second.</span></div><div class="line">    std::uint32_t serverUploadLimitBps = serverUploadLimitMbps*1000*1000/8;</div><div class="line">    server.<a class="code" href="class_r_c_f_1_1_rcf_server.html#abd33667252be8b2d2d839ce4e0118928">setUploadBandwidthLimit</a>(serverUploadLimitBps);</div><div class="line"></div><div class="line">    <span class="comment">// 5 Mbps upload limit.</span></div><div class="line">    std::uint32_t serverDownloadLimitMbps = 5;</div><div class="line">    </div><div class="line">    <span class="comment">// Convert to bytes/second.</span></div><div class="line">    std::uint32_t serverDownloadLimitBps = serverDownloadLimitMbps*1000*1000/8;</div><div class="line">    server.<a class="code" href="class_r_c_f_1_1_rcf_server.html#abd33667252be8b2d2d839ce4e0118928">setUploadBandwidthLimit</a>(serverDownloadLimitBps);</div></div><!-- fragment --><p> If for example three clients connect to this server and begin uploading files, the upload bandwidth consumed by all three clients together, will not be allowed to exceed 1 Mbps.</p>
<p>Similarly, if the three clients are downloading files simultaneously, the total download bandwidth consumed by the clients will not be allowed to exceed 5 Mbps.</p>
<h2><a class="anchor" id="CustomBandwidthLimit"></a>
Custom Server-Side Bandwidth Limits</h2>
<p>RCF also supports setting bandwidth limits on a more granular level, with application-defined subsets of clients sharing a particular bandwidth quota.</p>
<p>For example, on a server connected to multiple networks with varying bandwidth characteristics, you would probably want to limit file transfer bandwidth based on which network the file transfer is taking place on. To do this, use <code><a class="el" href="class_r_c_f_1_1_rcf_server.html#a4a5fc6d431197f3b1a5e591f214fd54e" title="Sets a custom upload bandwidth quota callback. The callback is called when a upload begins...">RCF::RcfServer::setUploadBandwidthQuotaCallback()</a></code> and <code><a class="el" href="class_r_c_f_1_1_rcf_server.html#a8562d11aef1f35026b843573b9f8be43" title="Sets a custom download bandwidth quota callback. The callback is called when a download begins...">RCF::RcfServer::setDownloadBandwidthQuotaCallback()</a></code> to configure a callback function for the <code>RcfServer</code> to call, whenever a file transfer is initiated.</p>
<p>From the callback function you can inspect the <code><a class="el" href="class_r_c_f_1_1_rcf_session.html" title="Represents a server side session, associated with a client connection. ">RCF::RcfSession</a></code> of the connection, and assign a relevant bandwidth quota to the file transfer.</p>
<p>For example, imagine we want to implement the following bandwidth limits:</p>
<ul>
<li>1 Mbps upload bandwidth for TCP connections from <code>192.168.*.*</code>.</li>
<li>56 Kbps upload bandwidth for TCP connections from <code>15.146.*.*</code>.</li>
<li>Unlimited upload bandwidth for all other connections.</li>
</ul>
<p>To implement this, we need three separate <code><a class="el" href="class_r_c_f_1_1_bandwidth_quota.html" title="Describes a unit of bandwidth, to be used by downloads or uploads, for a single connection or a group...">RCF::BandwidthQuota</a></code> objects, to represent the three bandwidth quotas listed above. Then, we can use <code><a class="el" href="class_r_c_f_1_1_rcf_server.html#a4a5fc6d431197f3b1a5e591f214fd54e" title="Sets a custom upload bandwidth quota callback. The callback is called when a upload begins...">RCF::RcfServer::setUploadBandwidthQuotaCallback()</a></code> to assign bandwidth quotas based on the IP address of the client:</p>
<div class="fragment"><div class="line"></div><div class="line"><span class="comment">// 1 Mbps quota bucket.</span></div><div class="line"><a class="code" href="_rcf_fwd_8hpp.html#a4c8282cc5e5b4903e715d8eb89dd1a2e">RCF::BandwidthQuotaPtr</a> quota_1_Mbps( <span class="keyword">new</span> <a class="code" href="class_r_c_f_1_1_bandwidth_quota.html">RCF::BandwidthQuota</a>(1*1000*1000/8) );</div><div class="line"></div><div class="line"><span class="comment">// 56 Kbps quota bucket.</span></div><div class="line"><a class="code" href="_rcf_fwd_8hpp.html#a4c8282cc5e5b4903e715d8eb89dd1a2e">RCF::BandwidthQuotaPtr</a> quota_56_Kbps( <span class="keyword">new</span> <a class="code" href="class_r_c_f_1_1_bandwidth_quota.html">RCF::BandwidthQuota</a>(56*1000/8) );</div><div class="line"></div><div class="line"><span class="comment">// Unlimited quota bucket.</span></div><div class="line"><a class="code" href="_rcf_fwd_8hpp.html#a4c8282cc5e5b4903e715d8eb89dd1a2e">RCF::BandwidthQuotaPtr</a> quota_unlimited( <span class="keyword">new</span> <a class="code" href="class_r_c_f_1_1_bandwidth_quota.html">RCF::BandwidthQuota</a>(0) );</div><div class="line"></div><div class="line"><a class="code" href="_rcf_fwd_8hpp.html#a4c8282cc5e5b4903e715d8eb89dd1a2e">RCF::BandwidthQuotaPtr</a> uploadBandwidthQuotaCb(<a class="code" href="class_r_c_f_1_1_rcf_session.html">RCF::RcfSession</a> &amp; session)</div><div class="line">{</div><div class="line">    <span class="comment">// Use clients IP address to determine which quota to allocate from.</span></div><div class="line"></div><div class="line">    <span class="keyword">const</span> <a class="code" href="class_r_c_f_1_1_remote_address.html">RCF::RemoteAddress</a> &amp; clientAddr = session.<a class="code" href="class_r_c_f_1_1_rcf_session.html#a475f3e53d1ff958e53c389215e56b470">getClientAddress</a>();</div><div class="line">    <span class="keyword">const</span> <a class="code" href="class_r_c_f_1_1_ip_address.html">RCF::IpAddress</a> &amp; clientIpAddr = <span class="keyword">dynamic_cast&lt;</span><span class="keyword">const </span><a class="code" href="class_r_c_f_1_1_ip_address.html">RCF::IpAddress</a> &amp;<span class="keyword">&gt;</span>(clientAddr);</div><div class="line">    <span class="keywordflow">if</span> ( clientIpAddr.matches( <a class="code" href="class_r_c_f_1_1_ip_address.html">RCF::IpAddress</a>(<span class="stringliteral">&quot;192.168.0.0&quot;</span>, 16) ) )</div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span> quota_1_Mbps;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( clientIpAddr.matches( <a class="code" href="class_r_c_f_1_1_ip_address.html">RCF::IpAddress</a>(<span class="stringliteral">&quot;15.146.0.0&quot;</span>, 16) ) )</div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span> quota_56_Kbps;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span> quota_unlimited;</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><div class="fragment"><div class="line">    <span class="comment">// Assign a custom file upload bandwidth limit.</span></div><div class="line">    server.<a class="code" href="class_r_c_f_1_1_rcf_server.html#a4a5fc6d431197f3b1a5e591f214fd54e">setUploadBandwidthQuotaCallback</a>(&amp;uploadBandwidthQuotaCb);</div></div><!-- fragment --> <h2><a class="anchor" id="ClientBandwidthLimit"></a>
Client-Side Bandwidth Limits</h2>
<p>To assign bandwidth limits from the client-side, use <code><a class="el" href="class_r_c_f_1_1_file_transfer_options.html#ab065964692da6577dd82b01949e37e9d" title="Bandwidth limit (bytes/sec). ">RCF::FileTransferOptions::mBandwidthLimitBps</a></code> and <code><a class="el" href="class_r_c_f_1_1_file_transfer_options.html#a8ae457362ca43356b770fc17ea02a854" title="Bandwidth quota associated with the transfer. ">RCF::FileTransferOptions::mBandwidthQuotaPtr</a></code>.</p>
<p><code><a class="el" href="class_r_c_f_1_1_file_transfer_options.html#ab065964692da6577dd82b01949e37e9d" title="Bandwidth limit (bytes/sec). ">RCF::FileTransferOptions::mBandwidthLimitBps</a></code> allows you to configure a bandwidth limit for a single client connection:</p>
<div class="fragment"><div class="line">    <a class="code" href="class_r_c_f_1_1_file_transfer_options.html">RCF::FileTransferOptions</a> transferOptions;</div><div class="line">    transferOptions.<a class="code" href="class_r_c_f_1_1_file_transfer_options.html#ab065964692da6577dd82b01949e37e9d">mBandwidthLimitBps</a> = 1024 * 1024; <span class="comment">// 1 MB/sec</span></div><div class="line">    client.getClientStub().downloadFile(downloadId, fileToDownloadTo, &amp;transferOptions);</div></div><!-- fragment --><p> <code><a class="el" href="class_r_c_f_1_1_file_transfer_options.html#a8ae457362ca43356b770fc17ea02a854" title="Bandwidth quota associated with the transfer. ">RCF::FileTransferOptions::mBandwidthQuotaPtr</a></code> allows you to share a bandwidth quota between multiple client connections. Here is an example of 3 clients uploading files concurrently, with the total bandwidth used by the clients not allowed to exceed 1 Mb/sec:</p>
<div class="fragment"><div class="line"></div><div class="line">        RcfClient&lt;I_PrintService&gt; client1(<a class="code" href="class_r_c_f_1_1_tcp_endpoint.html">RCF::TcpEndpoint</a>(50001));</div><div class="line">        RcfClient&lt;I_PrintService&gt; client2(<a class="code" href="class_r_c_f_1_1_tcp_endpoint.html">RCF::TcpEndpoint</a>(50001));</div><div class="line">        RcfClient&lt;I_PrintService&gt; client3(<a class="code" href="class_r_c_f_1_1_tcp_endpoint.html">RCF::TcpEndpoint</a>(50001));</div><div class="line"></div><div class="line">        <a class="code" href="_rcf_fwd_8hpp.html#a4c8282cc5e5b4903e715d8eb89dd1a2e">RCF::BandwidthQuotaPtr</a> clientQuotaPtr(<span class="keyword">new</span> <a class="code" href="class_r_c_f_1_1_bandwidth_quota.html">RCF::BandwidthQuota</a>(1024*1024));</div><div class="line"></div><div class="line">        <span class="keyword">auto</span> doUpload = [=](RcfClient&lt;I_PrintService&gt;&amp; client)</div><div class="line">        {</div><div class="line">            std::string uploadId                    = RCF::generateUuid();</div><div class="line">            <a class="code" href="_file_system_8hpp.html#acd9dc05ff33e8a344d94fe7fb9421092">RCF::Path</a> fileToUpload                  = <span class="stringliteral">&quot;C:\\Document1.pdf&quot;</span>;</div><div class="line">            <a class="code" href="class_r_c_f_1_1_file_transfer_options.html">RCF::FileTransferOptions</a> transferOptions;</div><div class="line">            transferOptions.<a class="code" href="class_r_c_f_1_1_file_transfer_options.html#a8ae457362ca43356b770fc17ea02a854">mBandwidthQuotaPtr</a>      = clientQuotaPtr;</div><div class="line">            client.getClientStub().uploadFile(uploadId, fileToUpload, &amp;transferOptions);</div><div class="line">        };</div><div class="line"></div><div class="line">        std::vector&lt;std::thread&gt; clientThreads;</div><div class="line">        clientThreads.push_back(std::thread(std::bind(doUpload, std::ref(client1))));</div><div class="line">        clientThreads.push_back(std::thread(std::bind(doUpload, std::ref(client2))));</div><div class="line">        clientThreads.push_back(std::thread(std::bind(doUpload, std::ref(client3))));</div><div class="line"></div><div class="line">        <span class="keywordflow">for</span> ( std::thread&amp; thread : clientThreads )</div><div class="line">        {</div><div class="line">            thread.join();</div><div class="line">        }</div><div class="line"></div></div><!-- fragment --></div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <!--  -->
    <li class="footer">Copyright (C) <a href="http://www.deltavsoft.com">Delta V Software</a> 2019</li>
    <!-- <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li> -->
  </ul>
</div>
                            </div>
        </div>
    </div>
</body>
</html>
